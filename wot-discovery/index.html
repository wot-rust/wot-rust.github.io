<!DOCTYPE html>
<html>

<head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        
    </title>

    

<link id="default" class="stylesheet" rel="stylesheet" href="https://wot-rust.github.io/default.css" />


    <!-- This script must follow css -->
    

    

    
    <script defer type="text/javascript" src="https://wot-rust.github.io/elasticlunr.min.js"></script>
    <script defer type="text/javascript" src="https://wot-rust.github.io/search_index.en.js"></script>
    

    
<link rel="icon" href="favicon.svg">


    <noscript>
        <style>
            .navbar-menu {
                display: block;
            }

            .js-only {
                display: none;
            }
        </style>
    </noscript>
    
</head>

<body>
    
    
<!-- START NAV -->


    

<header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                
                <a class="navbar-item" href="/">
                    
                    <img src="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;wot-rust&#x2F;media&#x2F;master&#x2F;svg&#x2F;logo.svg"
                        alt="Home">
                    
                </a>
                
                <span class="navbar-burger burger" data-target="navbarMenu">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </div>
            <div id="navbarMenu" class="navbar-menu">
                <div class="navbar-end">
                    
                    
                    
                    
                    <a itemprop="url"
                        class="navbar-item "
                        href="https:&#x2F;&#x2F;github.com&#x2F;wot-rust">
                        <span itemprop="name">Github
                        </span>
                    </a>
                    
                    
                    
                    <a itemprop="url"
                        class="navbar-item "
                        href="https:&#x2F;&#x2F;discord.gg&#x2F;5zy68ukBrv">
                        <span itemprop="name">Discord
                        </span>
                    </a>
                    
                    
                    
                    <a itemprop="url"
                        class="navbar-item "
                        href="https:&#x2F;&#x2F;wot-rust.github.io&#x2F;coc">
                        <span itemprop="name">Code of Conduct
                        </span>
                    </a>
                    
                    

                    
                    <div class="navbar-item search-container js-only">
                        <input class="input" id="search" type="search" placeholder="Search">

                        <div class="search-results box">
                            <div class="search-results__items"></div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </nav>
</header>


    

<!-- END NAV -->
<main>
    <section class="container">
        <div class="columns is-desktop">
            <div class="column is-10-desktop is-offset-1-desktop">
                <article itemscope itemtype="http://schema.org/BlogPosting">
                    <div class="card article">
                        <div class="card-content">
                            
<header>
    <div class="has-text-centered">
        <a href="https://wot-rust.github.io/wot-discovery/">
            <p class="title article-title">wot-discovery design notes
            </p>
        </a>
        <div class="tags has-addons level-item">
            
            <span class="tag is-rounded">2023-09-02</span>
            
            
            <span class="tag is-rounded is-primary">
                    
                    Luca Barbato
                    
                    
            </span>
            
            <span class="tag is-rounded">
<svg class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round"
    stroke-linejoin="round" stroke-width="6.25%">
    <circle cx="16" cy="16" r="14" />
    <path d="M16 8 L16 16 20 20" />
</svg>
<span>&nbsp;4 minute read</span>
</span>
        </div>
    </div>
</header>

                            <div itemprop="articleBody" class="content article-body">
                                <p>We are quickly iterating over the <a href="https://crates.io/crates/wot-discovery">wot-discovery</a> crate.
Here some notes about <a href="https://www.w3.org/TR/wot-discovery">Discovery specification</a>.</p>
<h2 id="discovery-and-directory">Discovery and Directory</h2>
<p>The <a href="https://www.w3.org/WoT/">W3C Web of Things</a> is all about to make connected devices (Things)
interoperate and cooperate.</p>
<p>In my opinion the greatest achievement is coming up with the <a href="https://www.w3.org/TR/wot-thing-description">Thing Description</a> to make possible
to both describe the status quo and pave the way of a more rational alternative. In WoT jargon the former
is called <code>brownfield</code> the latter <code>greenfield</code>.
But since being able to describe how to interact with Things is only part of the problems we have additional
facets specified in other documents, one of them id <a href="https://www.w3.org/TR/wot-discovery">WoT Discovery</a>.</p>
<p>The document is mostly oriented on possible greenfield implementations and in my opinion it tries to bring in
too much at the same time.</p>
<p>Once you come up with a mechanism to discover unknown nodes in your networks one may argue that the problem is
solved, other may argue that it doesn't stop at enumeration and you would like to do more:</p>
<ul>
<li>Your network may be partitioned so you would need to export one neightbourhood information to another, e.g.
You may want to have gateways across different kind of networks (e.g. bluetooth vs wifi) and keep a full
picture.</li>
<li>Querying may be important if the whole lot of devices may be too much to deal with at the same time, e.g.
all the sensors in a big city.</li>
</ul>
<p>Thus the <a href="https://wot-rust.github.io/wot-discovery/Discovery">WoT Discovery</a> document is conceptually split in two:</p>
<ul>
<li>Actual means to Advertise and Discover Things.</li>
<li>Means to aggregate and query and present the Things discovered.</li>
</ul>
<p>In wot-rust we split the implementations addressing the two concerns in two crates:</p>
<ul>
<li><a href="https://crates.io/crates/wot-discovery">wot-discovery</a>, a library crate, so far is able to discover HTTP/S Things using mDNS-SD.</li>
<li><a href="https://crates.io/crates/wot-directory">wot-directory</a>, a <a href="https://crates.io/crates/wot-serve">wot-serve</a> extension.</li>
</ul>
<h2 id="discovery">Discovery</h2>
<p>Of the different <a href="https://www.w3.org/TR/wot-discovery/#introduction-mech">Introduction Mechanisms</a> detailed,
what is currently implemented is the mDNS-mediated DNS-SD system.</p>
<p>The small API surface exposed boils down to setting up a <code>Discover</code> that starts the mDNS discovery system and provides a
<a href="https://docs.rs/futures/latest/futures/stream/trait.Stream.html">Stream</a> of Things by fetching them using HTTP/HTTPS.</p>
<p>In <code>0.2.0</code>, the API supports the <a href="https://crates.io/crates/wot-td">wot-td</a> <a href="https://docs.rs/wot-td/latest/wot_td/extend/index.html">extension</a> system.</p>
<p>Since in order to consume the produced Things it is necessary to have a populated <code>Thing::base</code> and right now the
specification is not yet explicit on what trasformations/patching the Directory may do with the <code>0.3.0</code> we
decided to simply provide the Thing wrapped in a <a href="https://docs.rs/wot-discovery/latest/wot_discovery/struct.Discovered.html">Discovered</a>
struct and provide accessors to know the address and port of the Servient that provided the Thing Description.</p>
<p>Here the example that lists all the Things available on the local network:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">use </span><span>std::future::ready;
</span><span>
</span><span style="color:#b48ead;">use </span><span>futures_util::StreamExt;
</span><span style="color:#b48ead;">use </span><span>serde::{Deserialize, Serialize};
</span><span style="color:#b48ead;">use </span><span>tracing::{info, trace, warn};
</span><span style="color:#b48ead;">use </span><span>tracing_subscriber::EnvFilter;
</span><span style="color:#b48ead;">use </span><span>wot_discovery::{Discovered, Discoverer};
</span><span style="color:#b48ead;">use </span><span>wot_td::extend::ExtendableThing;
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Clone, Serialize, Deserialize)]
</span><span style="color:#b48ead;">struct </span><span>A {}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>ExtendableThing </span><span style="color:#b48ead;">for </span><span>A {
</span><span>    </span><span style="color:#b48ead;">type </span><span>InteractionAffordance = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>PropertyAffordance = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>ActionAffordance = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>EventAffordance = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>Form = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>ExpectedResponse = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>DataSchema = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>ObjectSchema = ();
</span><span>    </span><span style="color:#b48ead;">type </span><span>ArraySchema = ();
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">tokio</span><span>::</span><span style="color:#bf616a;">main</span><span>]
</span><span>async </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> filter = EnvFilter::try_from_default_env()
</span><span>        .</span><span style="color:#96b5b4;">or_else</span><span>(|_| EnvFilter::try_new(&quot;</span><span style="color:#a3be8c;">info</span><span>&quot;))
</span><span>        .</span><span style="color:#96b5b4;">unwrap</span><span>();
</span><span>
</span><span>    tracing_subscriber::fmt().</span><span style="color:#96b5b4;">with_env_filter</span><span>(filter).</span><span style="color:#96b5b4;">init</span><span>();
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> d = Discoverer::new()?.ext::&lt;A&gt;();
</span><span>
</span><span>    d.</span><span style="color:#96b5b4;">stream</span><span>()?
</span><span>        .</span><span style="color:#96b5b4;">for_each</span><span>(|</span><span style="color:#bf616a;">discovered</span><span>| {
</span><span>            </span><span style="color:#b48ead;">match</span><span> discovered {
</span><span>                Ok(Discovered { thing: t, .. }) =&gt; {
</span><span>                    info!(&quot;</span><span style="color:#a3be8c;">found {:?} {:?}</span><span>&quot;, t.title, t.id,);
</span><span>                    trace!(&quot;</span><span style="color:#a3be8c;">{}</span><span>&quot;, serde_json::to_string_pretty(&amp;t).</span><span style="color:#96b5b4;">unwrap</span><span>());
</span><span>                }
</span><span>                Err(e) =&gt; warn!(&quot;</span><span style="color:#a3be8c;">something went wrong {:?}</span><span>&quot;, e),
</span><span>            }
</span><span>            </span><span style="color:#96b5b4;">ready</span><span>(())
</span><span>        })
</span><span>        .await;
</span><span>
</span><span>    Ok(())
</span><span>}
</span></code></pre>
<h2 id="directory">Directory</h2>
<p>Right now the repository is empty and as the WoT Discovery 2.0 specification start we'll implement a tiny subset of the Directory and
hopefully see if there is enough consensus to support small query languages along with richer but heavy systems such as <a href="https://www.w3.org/TR/sparql11-overview">SPARQL</a>
even if <a href="https://crates.io/crates/oxigraph">oxygraph</a> provides us the building blocks to provide it if there is enough interest.</p>

                            </div>
                        </div>
                        
                        
<footer class="card-footer">
    <div class="article-footer">
        <div class="columns is-multiline">
            <div class="column is-12">
                <p>
                    Published
                    

<time datetime="2023-09-02">
    2023-09-02
</time>


                    

by

<a href="https://wot-rust.github.io/authors/luca-barbato/">
    <span class="tag is-primary">Luca Barbato </span>
</a>




                    


in <a href="https://wot-rust.github.io/categories/releases/">
    <span class="tag is-success">
        Releases
    </span>
</a>


                    

and tagged

<a href="https://wot-rust.github.io/tags/rust/">
    <span class="tag is-link">rust </span>
</a>



and




<a href="https://wot-rust.github.io/tags/wot/">
    <span class="tag is-link">wot </span>
</a>






                </p>
            </div>
            <div class="column">
                <a class="button is-pulled-right is-info" href="/">Back Home</a>
            </div>
        </div>
    </div>
</footer>

                        
                    </div>
                </article>
            </div>
        </div>
    </section>
</main>

    
    


    

    <script type="text/javascript" src="https://wot-rust.github.io/js/zulma_navbar.js"></script>

    
    <script type="text/javascript" src="https://wot-rust.github.io/js/zulma_search.js"></script>
    

    
</body>

</html>